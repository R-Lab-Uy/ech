stringr::str_trim() %>%
cranlogs::cran_downloads(packages = ., when = "last-month") %>%
group_by(package) %>%
summarize(count = sum(count)) %>%
arrange(desc(count))
install.packages("cranlogs")
library(rvest)
library(dplyr)
spatial_task_view <- read_html("https://cran.r-project.org/web/views/Spatial.html")
res <- spatial_task_view %>%
html_nodes(xpath = "/html/body/ul[1]") %>%
html_children() %>%
html_text()
pkgs <- res %>%
stringr::str_replace_all("\\(core\\)", "") %>%
stringr::str_trim() %>%
cranlogs::cran_downloads(packages = ., when = "last-month") %>%
group_by(package) %>%
summarize(count = sum(count)) %>%
arrange(desc(count))
installed.packages()[!installed.packages() %in% pkgs$package]
install.packages("roxygen2")
all_years <- c(seq(1990, 2000, 2), seq(2003, 2009, 3), seq(2011, 2017, 2))
urls <- c(
paste0(
"http://observatorio.ministeriodesarrollosocial.gob.cl/casen/layout/doc/bases/Casen",
seq(1990, 1994, 2),
".zip"
),
"http://observatorio.ministeriodesarrollosocial.gob.cl/casen/layout/doc/bases/Casen1996.rar",
paste0(
"http://observatorio.ministeriodesarrollosocial.gob.cl/casen/layout/doc/bases/Casen",
seq(1998, 2000, 2),
".zip"
),
"http://observatorio.ministeriodesarrollosocial.gob.cl/casen/layout/doc/bases/Casen2003.zip",
"http://observatorio.ministeriodesarrollosocial.gob.cl/casen/layout/doc/bases/casen2006.zip",
"http://observatorio.ministeriodesarrollosocial.gob.cl/casen/layout/doc/bases/Casen2009spss.rar",
"http://observatorio.ministeriodesarrollosocial.gob.cl/casen/layout/doc/bases/casen2011_octubre2011_enero2012_principal_08032013spss.rar",
"http://observatorio.ministeriodesarrollosocial.gob.cl/documentos/CASEN_2013_MN_B_Principal_spss.rar",
"http://observatorio.ministeriodesarrollosocial.gob.cl/casen-multidimensional/casen/docs/casen_2015_spss.rar",
"http://observatorio.ministeriodesarrollosocial.gob.cl/casen-multidimensional/casen/docs/casen_2017_spss.rar"
)
all_years <- 2011:2017
urls <- cbind(year = 2011:2017,
md = c( "http://www.ine.gub.uy/c/document_library/get_file?uuid=7eecaefc-be12-4f5f-93a4-d53cc2a20070&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=47ff59b2-ed30-408d-a94c-05220e75d39b&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=de9bb13a-9740-4732-8826-10b3489999b7&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=7aa5ba66-dc54-418d-85d9-9985c88ffde8&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=ecdb10a5-c2a6-46ba-bc49-d539e0264bbd&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=2043b2a5-d328-48a6-a65e-27be2a974924&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=e30dd18d-c9df-4740-952d-f7ab9ef4f8e4&groupId=10181"),
dic = c("http://www.ine.gub.uy/c/document_library/get_file?uuid=54523778-5f53-4df1-a265-3ff520941bca&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=8e8963a6-b9f2-47f3-abf5-119f988ad868&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=055d37e5-d587-4ba7-8a0d-358cd99a9e24&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=9c9612fd-3bc3-47c5-a684-06daaf25da6c&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=6287d12b-1003-4402-86ba-a48866743d88&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=54f72e41-e671-4bea-993c-631596e16883&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=b60f247b-03cb-4bb1-b84b-5d7328479fe2&groupId=10181"))
carpeta = getwd()
links <- data.frame(
year = all_years,
url = urls$md,
file = paste0(carpeta, "/", all_years, "_spss", gsub(".*\\.", "\\.", urls)),
stringsAsFactors = FALSE
)
links <- data.frame(
year = all_years,
url = urls[,2],
file = paste0(carpeta, "/", all_years, "_spss", gsub(".*\\.", "\\.", urls)),
stringsAsFactors = FALSE
)
View(links)
gsub(".*\\.", "\\.", urls[,2])
urls <- data.frame(cbind(year = 2011:2017,
md = c( "http://www.ine.gub.uy/c/document_library/get_file?uuid=7eecaefc-be12-4f5f-93a4-d53cc2a20070&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=47ff59b2-ed30-408d-a94c-05220e75d39b&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=de9bb13a-9740-4732-8826-10b3489999b7&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=7aa5ba66-dc54-418d-85d9-9985c88ffde8&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=ecdb10a5-c2a6-46ba-bc49-d539e0264bbd&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=2043b2a5-d328-48a6-a65e-27be2a974924&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=e30dd18d-c9df-4740-952d-f7ab9ef4f8e4&groupId=10181"),
dic = c("http://www.ine.gub.uy/c/document_library/get_file?uuid=54523778-5f53-4df1-a265-3ff520941bca&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=8e8963a6-b9f2-47f3-abf5-119f988ad868&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=055d37e5-d587-4ba7-8a0d-358cd99a9e24&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=9c9612fd-3bc3-47c5-a684-06daaf25da6c&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=6287d12b-1003-4402-86ba-a48866743d88&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=54f72e41-e671-4bea-993c-631596e16883&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=b60f247b-03cb-4bb1-b84b-5d7328479fe2&groupId=10181"),
file = paste0(carpeta, "/", all_years, "_spss")),
stringsAsFactors = FALSE)
1:nrow(links)
urls <- data.frame(cbind(year = 2011:2017,
md = c( "http://www.ine.gub.uy/c/document_library/get_file?uuid=7eecaefc-be12-4f5f-93a4-d53cc2a20070&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=47ff59b2-ed30-408d-a94c-05220e75d39b&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=de9bb13a-9740-4732-8826-10b3489999b7&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=7aa5ba66-dc54-418d-85d9-9985c88ffde8&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=ecdb10a5-c2a6-46ba-bc49-d539e0264bbd&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=2043b2a5-d328-48a6-a65e-27be2a974924&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=e30dd18d-c9df-4740-952d-f7ab9ef4f8e4&groupId=10181"),
dic = c("http://www.ine.gub.uy/c/document_library/get_file?uuid=54523778-5f53-4df1-a265-3ff520941bca&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=8e8963a6-b9f2-47f3-abf5-119f988ad868&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=055d37e5-d587-4ba7-8a0d-358cd99a9e24&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=9c9612fd-3bc3-47c5-a684-06daaf25da6c&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=6287d12b-1003-4402-86ba-a48866743d88&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=54f72e41-e671-4bea-993c-631596e16883&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=b60f247b-03cb-4bb1-b84b-5d7328479fe2&groupId=10181"),
file = paste0(carpeta, "/", all_years, "_spss")),
stringsAsFactors = FALSE)
links <- urls[urls$year %in% anios, ]
anios <- all_years
links <- urls[urls$year %in% anios, ]
j=1
u <- links$url[[j]]
f <- links$file[[j]]
y <- links$year[[j]]
u <- links$md[[j]]
f <- links$file[[j]]
y <- links$year[[j]]
try(utils::download.file(u, f, mode = "wb"))
urls <- data.frame(cbind(year = 2011:2017,
md_sav = c( "http://www.ine.gub.uy/c/document_library/get_file?uuid=cc986929-5916-4d4f-a87b-3fb20a169879&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=144daa3d-0ebf-4106-ae11-a150511addf9&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=9ddf38cc-99bb-4196-992b-77530b025237&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=68cc1d11-e017-4a6d-a749-5a1e1a4a5306&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=7c62ef78-0cc6-4fba-aae4-921ff5ceddd6&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=715c873b-539f-4e92-9159-d38063270951&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=e38ea53c-7253-4007-9f67-2f5f161eea91&groupId=10181"),
md_dat = c( "http://www.ine.gub.uy/c/document_library/get_file?uuid=7eecaefc-be12-4f5f-93a4-d53cc2a20070&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=47ff59b2-ed30-408d-a94c-05220e75d39b&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=de9bb13a-9740-4732-8826-10b3489999b7&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=7aa5ba66-dc54-418d-85d9-9985c88ffde8&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=ecdb10a5-c2a6-46ba-bc49-d539e0264bbd&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=2043b2a5-d328-48a6-a65e-27be2a974924&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=e30dd18d-c9df-4740-952d-f7ab9ef4f8e4&groupId=10181"),
dic = c("http://www.ine.gub.uy/c/document_library/get_file?uuid=54523778-5f53-4df1-a265-3ff520941bca&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=8e8963a6-b9f2-47f3-abf5-119f988ad868&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=055d37e5-d587-4ba7-8a0d-358cd99a9e24&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=9c9612fd-3bc3-47c5-a684-06daaf25da6c&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=6287d12b-1003-4402-86ba-a48866743d88&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=54f72e41-e671-4bea-993c-631596e16883&groupId=10181",
"http://www.ine.gub.uy/c/document_library/get_file?uuid=b60f247b-03cb-4bb1-b84b-5d7328479fe2&groupId=10181"),
file = paste0(carpeta, "/ech_", all_years, "_spss.rar")),
stringsAsFactors = FALSE)
tempdir()
all_years <- 2011:2018
urls <- data.frame(year = 2011:2018,
md_sav = fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=cc986929-5916-4d4f-a87b-3fb20a169879&groupId=10181",
"get_file?uuid=144daa3d-0ebf-4106-ae11-a150511addf9&groupId=10181",
"get_file?uuid=9ddf38cc-99bb-4196-992b-77530b025237&groupId=10181",
"get_file?uuid=68cc1d11-e017-4a6d-a749-5a1e1a4a5306&groupId=10181",
"get_file?uuid=7c62ef78-0cc6-4fba-aae4-921ff5ceddd6&groupId=10181",
"get_file?uuid=715c873b-539f-4e92-9159-d38063270951&groupId=10181",
"get_file?uuid=e38ea53c-7253-4007-9f67-2f5f161eea91&groupId=10181",
"get_file?uuid=b63b566f-8d11-443d-bcd8-944f137c5aaf&groupId=10181"
)),
md_dat = fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=7eecaefc-be12-4f5f-93a4-d53cc2a20070&groupId=10181",
"get_file?uuid=47ff59b2-ed30-408d-a94c-05220e75d39b&groupId=10181",
"get_file?uuid=de9bb13a-9740-4732-8826-10b3489999b7&groupId=10181",
"get_file?uuid=7aa5ba66-dc54-418d-85d9-9985c88ffde8&groupId=10181",
"get_file?uuid=ecdb10a5-c2a6-46ba-bc49-d539e0264bbd&groupId=10181",
"get_file?uuid=2043b2a5-d328-48a6-a65e-27be2a974924&groupId=10181",
"get_file?uuid=e30dd18d-c9df-4740-952d-f7ab9ef4f8e4&groupId=10181",
"get_file?uuid=32a696cf-38d9-46cb-ad16-8fea69262581&groupId=10181")),
dic = fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=54523778-5f53-4df1-a265-3ff520941bca&groupId=10181",
"get_file?uuid=8e8963a6-b9f2-47f3-abf5-119f988ad868&groupId=10181",
"get_file?uuid=055d37e5-d587-4ba7-8a0d-358cd99a9e24&groupId=10181",
"get_file?uuid=9c9612fd-3bc3-47c5-a684-06daaf25da6c&groupId=10181",
"get_file?uuid=6287d12b-1003-4402-86ba-a48866743d88&groupId=10181",
"get_file?uuid=54f72e41-e671-4bea-993c-631596e16883&groupId=10181",
"get_file?uuid=b60f247b-03cb-4bb1-b84b-5d7328479fe2&groupId=10181",
"get_file?uuid=73b6cc21-1bb0-483b-a463-819315b5fff3&groupId=10181")),
file = paste0(folder, "/ech_", all_years, "_", format,".rar"),
stringsAsFactors = FALSE)
folder = getwd()
urls <- data.frame(year = 2011:2018,
md_sav = fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=cc986929-5916-4d4f-a87b-3fb20a169879&groupId=10181",
"get_file?uuid=144daa3d-0ebf-4106-ae11-a150511addf9&groupId=10181",
"get_file?uuid=9ddf38cc-99bb-4196-992b-77530b025237&groupId=10181",
"get_file?uuid=68cc1d11-e017-4a6d-a749-5a1e1a4a5306&groupId=10181",
"get_file?uuid=7c62ef78-0cc6-4fba-aae4-921ff5ceddd6&groupId=10181",
"get_file?uuid=715c873b-539f-4e92-9159-d38063270951&groupId=10181",
"get_file?uuid=e38ea53c-7253-4007-9f67-2f5f161eea91&groupId=10181",
"get_file?uuid=b63b566f-8d11-443d-bcd8-944f137c5aaf&groupId=10181"
)),
md_dat = fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=7eecaefc-be12-4f5f-93a4-d53cc2a20070&groupId=10181",
"get_file?uuid=47ff59b2-ed30-408d-a94c-05220e75d39b&groupId=10181",
"get_file?uuid=de9bb13a-9740-4732-8826-10b3489999b7&groupId=10181",
"get_file?uuid=7aa5ba66-dc54-418d-85d9-9985c88ffde8&groupId=10181",
"get_file?uuid=ecdb10a5-c2a6-46ba-bc49-d539e0264bbd&groupId=10181",
"get_file?uuid=2043b2a5-d328-48a6-a65e-27be2a974924&groupId=10181",
"get_file?uuid=e30dd18d-c9df-4740-952d-f7ab9ef4f8e4&groupId=10181",
"get_file?uuid=32a696cf-38d9-46cb-ad16-8fea69262581&groupId=10181")),
dic = fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=54523778-5f53-4df1-a265-3ff520941bca&groupId=10181",
"get_file?uuid=8e8963a6-b9f2-47f3-abf5-119f988ad868&groupId=10181",
"get_file?uuid=055d37e5-d587-4ba7-8a0d-358cd99a9e24&groupId=10181",
"get_file?uuid=9c9612fd-3bc3-47c5-a684-06daaf25da6c&groupId=10181",
"get_file?uuid=6287d12b-1003-4402-86ba-a48866743d88&groupId=10181",
"get_file?uuid=54f72e41-e671-4bea-993c-631596e16883&groupId=10181",
"get_file?uuid=b60f247b-03cb-4bb1-b84b-5d7328479fe2&groupId=10181",
"get_file?uuid=73b6cc21-1bb0-483b-a463-819315b5fff3&groupId=10181")),
file = paste0(folder, "/ech_", all_years, "_", format,".rar"),
stringsAsFactors = FALSE)
format = "sav"
urls <- data.frame(year = 2011:2018,
md_sav = fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=cc986929-5916-4d4f-a87b-3fb20a169879&groupId=10181",
"get_file?uuid=144daa3d-0ebf-4106-ae11-a150511addf9&groupId=10181",
"get_file?uuid=9ddf38cc-99bb-4196-992b-77530b025237&groupId=10181",
"get_file?uuid=68cc1d11-e017-4a6d-a749-5a1e1a4a5306&groupId=10181",
"get_file?uuid=7c62ef78-0cc6-4fba-aae4-921ff5ceddd6&groupId=10181",
"get_file?uuid=715c873b-539f-4e92-9159-d38063270951&groupId=10181",
"get_file?uuid=e38ea53c-7253-4007-9f67-2f5f161eea91&groupId=10181",
"get_file?uuid=b63b566f-8d11-443d-bcd8-944f137c5aaf&groupId=10181"
)),
md_dat = fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=7eecaefc-be12-4f5f-93a4-d53cc2a20070&groupId=10181",
"get_file?uuid=47ff59b2-ed30-408d-a94c-05220e75d39b&groupId=10181",
"get_file?uuid=de9bb13a-9740-4732-8826-10b3489999b7&groupId=10181",
"get_file?uuid=7aa5ba66-dc54-418d-85d9-9985c88ffde8&groupId=10181",
"get_file?uuid=ecdb10a5-c2a6-46ba-bc49-d539e0264bbd&groupId=10181",
"get_file?uuid=2043b2a5-d328-48a6-a65e-27be2a974924&groupId=10181",
"get_file?uuid=e30dd18d-c9df-4740-952d-f7ab9ef4f8e4&groupId=10181",
"get_file?uuid=32a696cf-38d9-46cb-ad16-8fea69262581&groupId=10181")),
dic = fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=54523778-5f53-4df1-a265-3ff520941bca&groupId=10181",
"get_file?uuid=8e8963a6-b9f2-47f3-abf5-119f988ad868&groupId=10181",
"get_file?uuid=055d37e5-d587-4ba7-8a0d-358cd99a9e24&groupId=10181",
"get_file?uuid=9c9612fd-3bc3-47c5-a684-06daaf25da6c&groupId=10181",
"get_file?uuid=6287d12b-1003-4402-86ba-a48866743d88&groupId=10181",
"get_file?uuid=54f72e41-e671-4bea-993c-631596e16883&groupId=10181",
"get_file?uuid=b60f247b-03cb-4bb1-b84b-5d7328479fe2&groupId=10181",
"get_file?uuid=73b6cc21-1bb0-483b-a463-819315b5fff3&groupId=10181")),
file = paste0(folder, "/ech_", all_years, "_", format,".rar"),
stringsAsFactors = FALSE)
links <- urls[urls$year %in% years, ] # urls %>% filter(year %in% years)
years=2017
links <- urls[urls$year %in% years, ] # urls %>% filter(year %in% years)
j=1
f <- links$file[[j]]
y <- links$year[[j]]
utils::download.file(u, f, mode = "wb"
)
u <- links[ifelse(format == "sav", 2, 3)][[j]]
utils::download.file(u, f, mode = "wb")
fs::path("http://www.ine.gub.uy/c/document_library",
c("get_file?uuid=54523778-5f53-4df1-a265-3ff520941bca&groupId=10181",
"get_file?uuid=8e8963a6-b9f2-47f3-abf5-119f988ad868&groupId=10181",
"get_file?uuid=055d37e5-d587-4ba7-8a0d-358cd99a9e24&groupId=10181",
"get_file?uuid=9c9612fd-3bc3-47c5-a684-06daaf25da6c&groupId=10181",
"get_file?uuid=6287d12b-1003-4402-86ba-a48866743d88&groupId=10181",
"get_file?uuid=54f72e41-e671-4bea-993c-631596e16883&groupId=10181",
"get_file?uuid=b60f247b-03cb-4bb1-b84b-5d7328479fe2&groupId=10181",
"get_file?uuid=73b6cc21-1bb0-483b-a463-819315b5fff3&groupId=10181"))
links[ifelse(format == "sav", 2, 3)][[j]]
utils::download.file(u, f, mode = "wb")
class(urls$md_sav)
utils::download.file("http:/www.ine.gub.uy/c/document_library/get_file?uuid=e38ea53c-7253-4007-9f67-2f5f161eea91&groupId=10181", f, mode = "wb")
download.file("http:/www.ine.gub.uy/c/document_library/get_file?uuid=e38ea53c-7253-4007-9f67-2f5f161eea91&groupId=10181", f, mode = "wb")
household_type <- function(data = df, weights = pesoano) {
data <- data %>% mutate_at(vars(e30,e26), unclass(.))
data <- data %>% dplyr::mutate(sex_householder = ifelse(e26 == 1 & e30 == 1,1, # 1 is man and householder
ifelse(e26 == 2 & e30 == 1,2,0)), #0 is woman householder
partner = ifelse(e30 == 2, 1, 0),
child = ifelse(e30 %in% 3:5, 1, 0),
child_law = ifelse(e30 == 6, 1, 0),
under_18 = ifelse(e27 < 18, 1, 0),
parents_brosis = ifelse(e30 %in% 7:10, 1, 0),
grandchild = ifelse(e30 == 11, 1, 0),
other_rel = ifelse(e30 == 12, 1, 0),
no_rel = ifelse(e30 == 13, 1, 0),)
data_h <- data %>% group_by(numero) %>%
mutate(sex_householder = max(sex_householder),
under_18 = max(under_18),
partner = max(partner),
child = max(child),
child_law = max(child_law),
parents_brosis = max(parents_brosis),
grandchild = max(grandchild),
other_rel = max(other_rel),
no_rel = max(no_rel)) %>%
filter(e30==1)
data_h <- data_h %>% mutate(household_type = ifelse(sum(partner, child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "unipersonal", #Single person
ifelse(partner > 0 & sum(child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "pareja",#Couple without children
ifelse(partner == 0 & child > 0  & sex_householder == 1 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0,"monoparental", #Single parent or Single father
ifelse(partner == 0 & child > 0 & sex_householder == 2 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "monomarental", #Single parent or Single mother
ifelse(partner > 0 & child > 0 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "biparental", #Couple with children
ifelse(under_18 == 0 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido sin menores", #Extended without children
ifelse(under_18 == 1 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido con menores", #Extended with children
ifelse(no_rel > 0, "compuesto","error")))))))) # composite)
)
# Estimación Total País
est_total <- data_h %>%
srvyr::as_survey_design(ids = numero, strata = estred13, weights = weights) %>%
srvyr::group_by(household_type) %>%
srvyr::summarise(tipo_hogar = srvyr::survey_total(vartype = "ci"))
return(est_total)
}
household_type(datos)
read_ech <- function(folder) {
# checks ----
if (!is.character(folder) | length(folder) != 1) {
message(glue::glue("Debe ingresar un directorio..."))
}
archivo <- fs::dir_ls(folder)
ext <- fs::path_ext(archivo)
compressed_formats <- c("zip", "rar")
uncompressed_formats <- c("sav", "dat")
# read ----
if (any(ext %in% c(compressed_formats, uncompressed_formats)) != TRUE) {
formats_string <- paste(c(compressed_formats, uncompressed_formats[length(uncompressed_formats) - 1]), collapse = ", ")
formats_string <- paste(c(formats_string, uncompressed_formats[length(uncompressed_formats)]), collapse = " o ")
stop(glue::glue("Los metadatos de {archivo} indica que este archivo no sirve. Asegurate de que el formato es {formats_string}."))
}
if (any(ext %in% compressed_formats)) {
message(glue::glue("Los metadatos de {archivo} indican que el formato comprimido es adecuado, intentando leer..."))
d <- try(haven::read_sav(archive::archive_read(archivo)))
}
if (any(ext %in% uncompressed_formats)) {
message(glue::glue("Los metadatos de {archivo} indican que el formato no comprimido es adecuado, intentando leer..."))
if (ext == uncompressed_formats[[1]]) {
d <- haven::read_sav(archivo)
}
if (ext == uncompressed_formats[[2]]) {
d <- haven::read_dta(archivo)
}
}
if (any(class(d) %in% "data.frame")) {
message(glue::glue("{archivo} se pudo leer como tibble :-)"))
d <- janitor::clean_names(d)
return(d)
} else {
stop(glue::glue("{archivo} no se pudo leer como tibble :-("))
}
}
read_ech("/home/calcita/Escritorio/pruebaech")
datos <- read_ech("/home/calcita/Escritorio/pruebaech")
household_type(datos)
library(dply)
library(dplyr)
household_type(datos)
household_type <- function(data = df, weights = pesoano) {
#data <- data %>% mutate_at(vars(e30,e26), unclass(.))
data <- data %>% dplyr::mutate(sex_householder = ifelse(e26 == 1 & e30 == 1,1, # 1 is man and householder
ifelse(e26 == 2 & e30 == 1,2,0)), #0 is woman householder
partner = ifelse(e30 == 2, 1, 0),
child = ifelse(e30 %in% 3:5, 1, 0),
child_law = ifelse(e30 == 6, 1, 0),
under_18 = ifelse(e27 < 18, 1, 0),
parents_brosis = ifelse(e30 %in% 7:10, 1, 0),
grandchild = ifelse(e30 == 11, 1, 0),
other_rel = ifelse(e30 == 12, 1, 0),
no_rel = ifelse(e30 == 13, 1, 0),)
data_h <- data %>% group_by(numero) %>%
mutate(sex_householder = max(sex_householder),
under_18 = max(under_18),
partner = max(partner),
child = max(child),
child_law = max(child_law),
parents_brosis = max(parents_brosis),
grandchild = max(grandchild),
other_rel = max(other_rel),
no_rel = max(no_rel)) %>%
filter(e30==1)
data_h <- data_h %>% mutate(household_type = ifelse(sum(partner, child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "unipersonal", #Single person
ifelse(partner > 0 & sum(child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "pareja",#Couple without children
ifelse(partner == 0 & child > 0  & sex_householder == 1 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0,"monoparental", #Single parent or Single father
ifelse(partner == 0 & child > 0 & sex_householder == 2 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "monomarental", #Single parent or Single mother
ifelse(partner > 0 & child > 0 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "biparental", #Couple with children
ifelse(under_18 == 0 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido sin menores", #Extended without children
ifelse(under_18 == 1 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido con menores", #Extended with children
ifelse(no_rel > 0, "compuesto","error")))))))) # composite)
)
# Estimación Total País
est_total <- data_h %>%
srvyr::as_survey_design(ids = numero, strata = estred13, weights = weights) %>%
srvyr::group_by(household_type) %>%
srvyr::summarise(tipo_hogar = srvyr::survey_total(vartype = "ci"))
return(est_total)
}
household_type <- function(data = df,
weights = pesoano,
strata = estred13) {
#data <- data %>% mutate_at(vars(e30,e26), unclass(.))
data <- data %>% dplyr::mutate(sex_householder = ifelse(e26 == 1 & e30 == 1,1, # 1 is man and householder
ifelse(e26 == 2 & e30 == 1,2,0)), #0 is woman householder
partner = ifelse(e30 == 2, 1, 0),
child = ifelse(e30 %in% 3:5, 1, 0),
child_law = ifelse(e30 == 6, 1, 0),
under_18 = ifelse(e27 < 18, 1, 0),
parents_brosis = ifelse(e30 %in% 7:10, 1, 0),
grandchild = ifelse(e30 == 11, 1, 0),
other_rel = ifelse(e30 == 12, 1, 0),
no_rel = ifelse(e30 == 13, 1, 0),)
data_h <- data %>% group_by(numero) %>%
mutate(sex_householder = max(sex_householder),
under_18 = max(under_18),
partner = max(partner),
child = max(child),
child_law = max(child_law),
parents_brosis = max(parents_brosis),
grandchild = max(grandchild),
other_rel = max(other_rel),
no_rel = max(no_rel)) %>%
filter(e30==1)
data_h <- data_h %>% mutate(household_type = ifelse(sum(partner, child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "unipersonal", #Single person
ifelse(partner > 0 & sum(child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "pareja",#Couple without children
ifelse(partner == 0 & child > 0  & sex_householder == 1 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0,"monoparental", #Single parent or Single father
ifelse(partner == 0 & child > 0 & sex_householder == 2 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "monomarental", #Single parent or Single mother
ifelse(partner > 0 & child > 0 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "biparental", #Couple with children
ifelse(under_18 == 0 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido sin menores", #Extended without children
ifelse(under_18 == 1 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido con menores", #Extended with children
ifelse(no_rel > 0, "compuesto","error")))))))) # composite)
)
# Estimación Total País
est_total <- data_h %>%
srvyr::as_survey_design(ids = numero, strata = strata, weights = weights) %>%
srvyr::group_by(household_type) %>%
srvyr::summarise(tipo_hogar = srvyr::survey_total(vartype = "ci"))
return(est_total)
}
household_type(datos)
household_type <- function(data = df,
weights = pesoano,
strata = "estred13") {
#data <- data %>% mutate_at(vars(e30,e26), unclass(.))
data <- data %>% dplyr::mutate(sex_householder = ifelse(e26 == 1 & e30 == 1,1, # 1 is man and householder
ifelse(e26 == 2 & e30 == 1,2,0)), #0 is woman householder
partner = ifelse(e30 == 2, 1, 0),
child = ifelse(e30 %in% 3:5, 1, 0),
child_law = ifelse(e30 == 6, 1, 0),
under_18 = ifelse(e27 < 18, 1, 0),
parents_brosis = ifelse(e30 %in% 7:10, 1, 0),
grandchild = ifelse(e30 == 11, 1, 0),
other_rel = ifelse(e30 == 12, 1, 0),
no_rel = ifelse(e30 == 13, 1, 0),)
data_h <- data %>% group_by(numero) %>%
mutate(sex_householder = max(sex_householder),
under_18 = max(under_18),
partner = max(partner),
child = max(child),
child_law = max(child_law),
parents_brosis = max(parents_brosis),
grandchild = max(grandchild),
other_rel = max(other_rel),
no_rel = max(no_rel)) %>%
filter(e30==1)
data_h <- data_h %>% mutate(household_type = ifelse(sum(partner, child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "unipersonal", #Single person
ifelse(partner > 0 & sum(child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "pareja",#Couple without children
ifelse(partner == 0 & child > 0  & sex_householder == 1 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0,"monoparental", #Single parent or Single father
ifelse(partner == 0 & child > 0 & sex_householder == 2 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "monomarental", #Single parent or Single mother
ifelse(partner > 0 & child > 0 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "biparental", #Couple with children
ifelse(under_18 == 0 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido sin menores", #Extended without children
ifelse(under_18 == 1 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido con menores", #Extended with children
ifelse(no_rel > 0, "compuesto","error")))))))) # composite)
)
# Estimación Total País
est_total <- data_h %>%
srvyr::as_survey_design(ids = numero, strata = strata, weights = weights) %>%
srvyr::group_by(household_type) %>%
srvyr::summarise(tipo_hogar = srvyr::survey_total(vartype = "ci"))
return(est_total)
}
household_type(datos)
household_type <- function(data = df,
weights = "pesoano",
strata = "estred13") {
#data <- data %>% mutate_at(vars(e30,e26), unclass(.))
data <- data %>% dplyr::mutate(sex_householder = ifelse(e26 == 1 & e30 == 1,1, # 1 is man and householder
ifelse(e26 == 2 & e30 == 1,2,0)), #0 is woman householder
partner = ifelse(e30 == 2, 1, 0),
child = ifelse(e30 %in% 3:5, 1, 0),
child_law = ifelse(e30 == 6, 1, 0),
under_18 = ifelse(e27 < 18, 1, 0),
parents_brosis = ifelse(e30 %in% 7:10, 1, 0),
grandchild = ifelse(e30 == 11, 1, 0),
other_rel = ifelse(e30 == 12, 1, 0),
no_rel = ifelse(e30 == 13, 1, 0),)
data_h <- data %>% group_by(numero) %>%
mutate(sex_householder = max(sex_householder),
under_18 = max(under_18),
partner = max(partner),
child = max(child),
child_law = max(child_law),
parents_brosis = max(parents_brosis),
grandchild = max(grandchild),
other_rel = max(other_rel),
no_rel = max(no_rel)) %>%
filter(e30==1)
data_h <- data_h %>% mutate(household_type = ifelse(sum(partner, child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "unipersonal", #Single person
ifelse(partner > 0 & sum(child, parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "pareja",#Couple without children
ifelse(partner == 0 & child > 0  & sex_householder == 1 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0,"monoparental", #Single parent or Single father
ifelse(partner == 0 & child > 0 & sex_householder == 2 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "monomarental", #Single parent or Single mother
ifelse(partner > 0 & child > 0 & sum(parents_brosis, grandchild, child_law, other_rel, no_rel) == 0, "biparental", #Couple with children
ifelse(under_18 == 0 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido sin menores", #Extended without children
ifelse(under_18 == 1 & (parents_brosis > 0 | grandchild > 0 | child_law > 0 | other_rel > 0) & no_rel == 0, "extendido con menores", #Extended with children
ifelse(no_rel > 0, "compuesto","error")))))))) # composite)
)
# Estimación Total País
est_total <- data_h %>%
srvyr::as_survey_design(ids = numero, strata = strata, weights = weights) %>%
srvyr::group_by(household_type) %>%
srvyr::summarise(tipo_hogar = srvyr::survey_total(vartype = "ci"))
return(est_total)
}
household_type(datos)
